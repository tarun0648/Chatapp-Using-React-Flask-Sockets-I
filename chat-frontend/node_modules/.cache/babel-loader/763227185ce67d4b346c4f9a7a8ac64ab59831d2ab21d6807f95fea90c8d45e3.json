{"ast":null,"code":"// frontend/src/services/socket.js - ENHANCED WITH LOGOUT HANDLING\nimport { io } from 'socket.io-client';\nlet socket = null;\nexport const initSocket = () => {\n  if (!socket || socket.disconnected) {\n    socket = io('http://localhost:5000', {\n      autoConnect: false,\n      transports: ['websocket', 'polling'],\n      reconnection: true,\n      reconnectionAttempts: 10,\n      reconnectionDelay: 1000,\n      reconnectionDelayMax: 5000,\n      timeout: 20000,\n      forceNew: false,\n      upgrade: true,\n      rememberUpgrade: true\n    });\n    socket.on('connect', () => {\n      console.log('🔌 Socket connected:', socket.id);\n    });\n    socket.on('disconnect', reason => {\n      console.log('🔌 Socket disconnected:', reason);\n      if (reason === 'io server disconnect') {\n        // the disconnection was initiated by the server, reconnect manually\n        socket.connect();\n      }\n    });\n    socket.on('connect_error', error => {\n      console.error('❌ Socket connection error:', error);\n    });\n    socket.on('reconnect', attemptNumber => {\n      console.log('🔄 Socket reconnected after', attemptNumber, 'attempts');\n    });\n    socket.on('reconnect_error', error => {\n      console.error('❌ Socket reconnection error:', error);\n    });\n    socket.on('reconnect_failed', () => {\n      console.error('❌ Socket reconnection failed');\n    });\n\n    // ✅ NEW: Handle logout confirmation\n    socket.on('logout_confirmed', data => {\n      console.log('🚪 Logout confirmed by server:', data);\n    });\n\n    // Add debug listeners for development\n    if (process.env.NODE_ENV === 'development') {\n      socket.onAny((event, ...args) => {\n        console.log('📡 Socket event received:', event, args);\n      });\n      socket.onAnyOutgoing((event, ...args) => {\n        console.log('📤 Socket event sent:', event, args);\n      });\n    }\n  }\n  return socket;\n};\nexport const getSocket = () => {\n  if (!socket) {\n    return initSocket();\n  }\n  return socket;\n};\n\n// ✅ ENHANCED: Proper disconnect with cleanup\nexport const disconnectSocket = () => {\n  if (socket) {\n    console.log('🔌 Disconnecting socket properly...');\n\n    // Remove all listeners to prevent memory leaks\n    socket.removeAllListeners();\n\n    // Disconnect the socket\n    socket.disconnect();\n    socket = null;\n    console.log('✅ Socket disconnected and cleaned up');\n  }\n};\nexport const connectSocket = () => {\n  if (socket && !socket.connected) {\n    socket.connect();\n  }\n};\nexport const isSocketConnected = () => {\n  return socket && socket.connected;\n};\n\n// ✅ NEW: Emit logout event\nexport const emitLogout = userId => {\n  if (socket && socket.connected) {\n    console.log('🚪 Emitting logout event for user:', userId);\n    socket.emit('user_logout', {\n      user_id: userId\n    });\n  }\n};","map":{"version":3,"names":["io","socket","initSocket","disconnected","autoConnect","transports","reconnection","reconnectionAttempts","reconnectionDelay","reconnectionDelayMax","timeout","forceNew","upgrade","rememberUpgrade","on","console","log","id","reason","connect","error","attemptNumber","data","process","env","NODE_ENV","onAny","event","args","onAnyOutgoing","getSocket","disconnectSocket","removeAllListeners","disconnect","connectSocket","connected","isSocketConnected","emitLogout","userId","emit","user_id"],"sources":["C:/Users/tarun/Downloads/chatappfinal/chat-frontend/src/services/socket.js"],"sourcesContent":["// frontend/src/services/socket.js - ENHANCED WITH LOGOUT HANDLING\r\nimport { io } from 'socket.io-client';\r\n\r\nlet socket = null;\r\n\r\nexport const initSocket = () => {\r\n  if (!socket || socket.disconnected) {\r\n    socket = io('http://localhost:5000', {\r\n      autoConnect: false,\r\n      transports: ['websocket', 'polling'],\r\n      reconnection: true,\r\n      reconnectionAttempts: 10,\r\n      reconnectionDelay: 1000,\r\n      reconnectionDelayMax: 5000,\r\n      timeout: 20000,\r\n      forceNew: false,\r\n      upgrade: true,\r\n      rememberUpgrade: true\r\n    });\r\n\r\n    socket.on('connect', () => {\r\n      console.log('🔌 Socket connected:', socket.id);\r\n    });\r\n\r\n    socket.on('disconnect', (reason) => {\r\n      console.log('🔌 Socket disconnected:', reason);\r\n      if (reason === 'io server disconnect') {\r\n        // the disconnection was initiated by the server, reconnect manually\r\n        socket.connect();\r\n      }\r\n    });\r\n\r\n    socket.on('connect_error', (error) => {\r\n      console.error('❌ Socket connection error:', error);\r\n    });\r\n\r\n    socket.on('reconnect', (attemptNumber) => {\r\n      console.log('🔄 Socket reconnected after', attemptNumber, 'attempts');\r\n    });\r\n\r\n    socket.on('reconnect_error', (error) => {\r\n      console.error('❌ Socket reconnection error:', error);\r\n    });\r\n\r\n    socket.on('reconnect_failed', () => {\r\n      console.error('❌ Socket reconnection failed');\r\n    });\r\n\r\n    // ✅ NEW: Handle logout confirmation\r\n    socket.on('logout_confirmed', (data) => {\r\n      console.log('🚪 Logout confirmed by server:', data);\r\n    });\r\n\r\n    // Add debug listeners for development\r\n    if (process.env.NODE_ENV === 'development') {\r\n      socket.onAny((event, ...args) => {\r\n        console.log('📡 Socket event received:', event, args);\r\n      });\r\n\r\n      socket.onAnyOutgoing((event, ...args) => {\r\n        console.log('📤 Socket event sent:', event, args);\r\n      });\r\n    }\r\n  }\r\n  \r\n  return socket;\r\n};\r\n\r\nexport const getSocket = () => {\r\n  if (!socket) {\r\n    return initSocket();\r\n  }\r\n  return socket;\r\n};\r\n\r\n// ✅ ENHANCED: Proper disconnect with cleanup\r\nexport const disconnectSocket = () => {\r\n  if (socket) {\r\n    console.log('🔌 Disconnecting socket properly...');\r\n    \r\n    // Remove all listeners to prevent memory leaks\r\n    socket.removeAllListeners();\r\n    \r\n    // Disconnect the socket\r\n    socket.disconnect();\r\n    socket = null;\r\n    \r\n    console.log('✅ Socket disconnected and cleaned up');\r\n  }\r\n};\r\n\r\nexport const connectSocket = () => {\r\n  if (socket && !socket.connected) {\r\n    socket.connect();\r\n  }\r\n};\r\n\r\nexport const isSocketConnected = () => {\r\n  return socket && socket.connected;\r\n};\r\n\r\n// ✅ NEW: Emit logout event\r\nexport const emitLogout = (userId) => {\r\n  if (socket && socket.connected) {\r\n    console.log('🚪 Emitting logout event for user:', userId);\r\n    socket.emit('user_logout', { user_id: userId });\r\n  }\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}